# 存储器

## 存储器的属性

### 作用

主存

外存

Cache

### 介质

磁盘、磁带

磁芯存储器

半导体存储器

光存储器

### 存取方式

RAM

ROM

由于flash memory 是从rom发展过来的，所以可以归类为rom

### 串行访问

顺序存取

​	按物理地址的先后顺序

直接

​	先找到某个区域，再顺序

### 信息可保存性

易失性

非易失性

破坏性读出

非破坏性读出

### 性能指标

存储容量

​	存储字数$\times$字长

单位成本

​	总成本/总容量

存储速度

​	数据的宽度/存取周期

其他

​	存取时间

​	存取周期

​		存取时间+复原时间

​	主存带宽

# 存储单元地址分配

按字或者按字节

>字的位数根据机器字长（或数据线根数）来算
>
>字节就是8位

编址

​	按X(B)编址

>最小单位是X(B)

​	寻址范围=存储容量(B)/X

>按什么编址最后 MAR也得是多少位

寻址

​	按字寻址，存储器最小单位是字

> 注意字有几字节跟机器字长有关	

# 多级存储系统

> 注意CPU与内存其实可以直接交换信息，不一定通过Cache

虚拟存储系统

Cache的性能

​	命中

​		命中代表数据在Cache中，可在Cache中存取。

​	有效存取时间

​		有效存取时间=命中率$\times$Cache存取时间+(1-命中率)$\times$主存存取时间

​	效率

​		Cache访问时间/平均访问时间	

# 半导体随机存储器

## 物理结构

1. 存储矩阵

2. 译码驱动

   地址信号翻译成选通信号

3. 读写电路

   包括读出放大器和写出电路

4. 读/写控制线 

5. 片选线  

6. 地址线 

   单向

7. 数据线

   双向

## 74138译码器（3/8译码器）

驿马地址输入端

​	A、B、C

选通端

​	$G_1、\overline{G_{2A}}、\overline{G_{2B}}$

>$G_1高电平\overline{G_{2A}}、\overline{G_{2B}}低电平，译码器才译出$

译码输出端

​	$\overline{Y_0}\sim \overline{Y_7}$

## SRAM存储器和DRAM存储器

### SRAM（静态随机存储器）

​	利用触发器（MOS）来存储信息，不需要再生（非破坏性读出）

​	存取速度快、集成度低、功耗大

### DRAM（动态随机存储器）

​	利用栅极电容上的电荷存储信息，需要刷新再生（刷新周期2ms，以行为单位刷新，题目不给这个条件）

​	容易集成、位价低、容量大、功耗低、存取速度慢、采用地址复用技术

#### 	刷新方式

​		集中刷新

​			一个刷新周期内，利用一段固定的时间全部刷新。

​			优缺点

​				读写操作不受刷新工作影响，存取速度高，但是死时间内不能访问。

​		分散刷新

​			把存储系统的工作周期加上刷新的任务

​			优缺点

​				1.没有死区，死时间，2.加长了系统的存取周期。

​		异步刷新

​			刷新间隔=刷新周期/行数

>行数得看芯片是什么结构
>
>$64\times64结构就是64行$
>
>字、位拓展之后，每个芯片其实还是自己刷新自己的，计算刷新间隔只用考虑一个芯片

​			刷新间隔内刷新一行

​			优缺点

​				1.不会加长存取周期 2.缩短了死时间

​		透明刷新

​			刷新安排在译码阶段，不会加长存取周期

###  存储器的读写周期

​	RAM的读周期

​		给出地址到外部数据总线产生数据的时间。

​		时序图：略

>读周期>读出时间

​	RAM的写周期

## 只读存储器（ROM）

优点

​	结构简单，位密度高

​	非易失性，可靠度高

### ROM的类型

​	掩膜式只读（MROM）

​		无法改变内容

​	一次可编程只读（PROM）

​	可擦除可编程只读（EPROM）

​	闪存

​	固态硬盘

# 存储器与CPU的连接

## 主存与CPU 

连线:

​	数据总线（连着CPU MDR）

​	读/写控制线（CPU控制主存）

​	地址总线（连着CPU MAR，CPU提供主存地址）



# 主存容量的拓展

单个芯片容量有限，字数或者字长不够

## 位拓展

两片芯片地址，片选端，读写控制端并联（公有信息）

一片芯片数据端连接数据总线高位，一片芯片数据端连接数据总线低位。

## 字拓展

两个芯片所有端都并联 。

## 字、位拓展

几个芯片一组，位拓展

加几组芯片，字拓展

>字拓展，地址线增加了，CPU的高位地址线负责片选

## 地址分配和片选

### 字选

CPU的低位地址线完成，低位地址线与所有存储芯片的地址线相连。

### 片选

高位地址线完成片选

#### 线选法

高位地址线直接（或反相器反相）分别连接至各个存储芯片的片选端（$\overline{CS}$）,为“0”就被选了，所以只能有一个为“0”。

优缺点：

​	线路简单，地址空间不连续（1，2，4，8，16......）。

#### 译码片选法

有几片就需要几个片选信号，加上译码器3位就可以译码为8位的片选信号。

## 芯片的选取和连接

1. 根据数据线算出字长，根据地址算出字数。

2. 选择芯片

3. 算出片内地址，然后根据几片算出高位地址（作为片选信号）

   >如果各个片的字数不一样
   >
   >字数高的
   >
   >​	经过1号译码器片选
   >
   >字数低的
   >
   >​	片数只有一片 就设计几个逻辑门（与不属于片内地址，也不属于片选信号地址的地址）共同协助生成片选信号
   >
   >​	片数多	则经过2号译码器

# 存储器存取速度的提升

## 多模块存储器

### 单体多字

​	一个存取周期取出连续的多个字

​	优缺点：连续存取速度快，但是必须是连续的。

### 多体并行

​	多个存储体独立工作

​	优缺点：不同的请求源可以请求不同的存储体。

#### 高位交叉编址（顺序存储）

​	高位作为选择存储体的信号，低位是体内地址。

​	优缺点：有利于存储器的扩充。

#### 低位交叉编址（交叉存储）

​	低位作为选择存储体的信号，高位是体内地址。

​	优缺点：连续读取速度快，大大增加了储存器的带宽。

​	带宽计算

​		一个存储体：

​			CPU先发送个工作命令耗时t，从发送命令之前到存储器完成任务是一个存取周期。

​		交叉存储的连续存取过程

​			CPU连续发送n个工作命令给n个存储体，n个存储体在各自的存取周期内完成任务

​			用时=一个存取周期+(n-1)个工作命令耗时

​		带宽=存取字/用时

# 其他

## 相联存储器

​	把数据搞成表格的形式，按内容（索引）寻址。

## 要加强存储器的带宽怎么加

​	芯片更强，总线宽度增加

## MAR的位数

​	首先至少满足主存地址空间（根据地址线根数算的）

## 存储容量=字长$\times$字数
# IO系统的组成

## IO软件

### IO指令

​	结构：操作码+命令码+设备码

>操作码表示该指令是什么类型的。（IO指令）

​	功能：

​		数据的输入输出

​		状态测试（检测设备是否“忙”）

​		某些操作指令（磁盘找磁道、读扇区）

​		IO指令是CPU指令的一部分

### 通道指令

​	有通道的IO系统专门设置的指令（存放在主存），由通道执行。

## IO硬件

​	外部设备

​	设备控制器：可以控制若干台同一类型的设备，连接IO接口

​	IO接口：通过IO总线连接CPU

​	IO总线	

# IO设备与主机的联系方式

## IO设备编址方式

​	统一编址：所用的指令与访存指令相似

​	不统一编址：有专用的IO指令

## 传送方式

​	并行和串行

## 联络方式

​	立即响应（指示灯）

​	异步

​	同步

## IO设备与主机的连接方式

​	辐射式

​		硬件成本高

​	总线式

## IO设备与主机信息传送的控制方式

### 程序查询

CPU不断查询IO设备是否ready，CPU工作效率不高，是串行工作方式。

### 程序中断

IO设备发出中断请求，予以响应，大大提高了工作效率，是并行工作方式。

#### 工作流程

1. CPU响应中断
2. 中断隐指令（硬件实现的）
3. 转去执行中断服务程序

##### 大部分中断处理的大致流程

1. 关中断

   保存现场之前要关中断，CPU不能响应更高级中断源的请求。

2. 保存断点

   将原来程序的指令地址保存下来

3. 引出中断服务程序 


   中断服务程序的入口地址叫做中断向量

   所有的中断向量存在中断向量表

4. **进入中断服务程序时保存现场和屏蔽字**

5. **开中断（可以实现多重中断）**

6. **中断事件处理**

7. **关中断**

8. **恢复现场和屏蔽字**

9. **开中断，中断返回**

>1-3是中断隐指令
>
>4-9是在中断服务程序里执行的


### 多重中断和中断屏蔽

#### 中断源与屏蔽字与优先级

例如有四个中断源A、B、C、D

优先级 D>A>C>B

D的中断屏蔽字为：1 1 1 1 屏蔽所有

A的中断屏蔽字为：1 1 1 0 屏蔽ABC





​	

### DMA方式

主存与IO设备之间有一条数据通路，如果CPU和DMA同时访问主存，让给DMA。

>DMA方式只用于传数据，鼠标和键盘不能用DMA，他们要处理事件

#### 结构

### DMA的传送方式

#### 停止CPU访问主存

#### DMA与CPU交替访问访存

#### 周期挪用

​	CPU不在访存时

​	CPU正在访存

​	CPU和IO同时发出请求

### DMA的传送过程

1. 预处理

   CPU执行IO指令设置DMA控制器的寄存器初值和传送方向，启动DMA控制器。等到IO设备准备好要发送的数据，接收的数据，IO设备向DMA控制器发出DMA请求，DMA向CPU发出总线请求。

2. 数据传送

   完全由DMA控制器实现

3. 后处理

   DMA向CPU发出中断请求，DMA执行中断服务程序做DMA结束处理（数据校验......）。

#### 工作流程

​	IO设备需要数据传送时通过DMA控制器CPU提出DMA传送请求，CPU让出系统总线，由DMA控制器接管总线进行数据传送。

# IO设备

IO设备=设备控制器+机、电、磁、光部件

## 键盘

键盘输入信息步骤

## 鼠标

## 显示器

CRT、字符显示器、图形显示器（矢量）、图像显示器（点阵）

各种显示器的不同，原理、结构（VRAM）、功能？

显示标准（MDA、CGA、EGA、VGA）

## 打印设备

### 击打式

​	活字打印机：字先刻在印子机构的表面

​	点阵针式打印机：钢针撞击色带

### 非击打式

​	激光打印机、静电打印机、喷墨打印机

## 其他IO设备

### 汉字处理设备

输入码：解决汉字的输入和识别（数字码、拼音、五笔）

内码：输入码转化为内码，在计算机内加工处理（通常两个字节）

字形码：显示或打印输出

# IO接口

## 功能

IO设备的选择

数据缓冲

数据“串－并”格式转换

点平转换

传送控制指令

监视设备的工作状态，并保存状态信息，供CPU查询

## 组成

这些线都跟IO总线相连

### 数据线

IO接口连接数据线，IO设备通过IO接口和数据线连接CPU，根数与存储字长的位数有关

>单向数据线需要两组实现输入输出

### 设备选择线

根数取决于设备码的位数，也是双向

### 命令线

CPU发出命令信号，单向

### 状态线

IO向主机报告的信号线

## 接口分类

数据传送方式：串/并

灵活性：可编程、不可编程

通用性：通用、专用

数据传送的控制方式：程序型（程序查询、程序中断）、DMA型

# 外存储器

## 磁盘存储器

### 存储区域

​	记录面

​		一个记录面一个磁头

​	磁道

​		记录面以磁道划分，不同记录面的相同编号的磁道是一个圆柱面，柱面数就是一个记录面的磁道数，不同磁道的存储容量是相同的。

​	扇区

​		磁盘读写的最小单位

### 硬盘存储器的组成

​	磁盘驱动器：核心是磁头和磁盘组件

​	磁盘控制器：磁盘存储器与主机的接口（IDE、SCSI、SATA）

### 磁记录原理

​	磁头和磁性记录介质相对运动时电磁转换完成读写



### 磁盘的性能指标

#### 磁盘的容量

非格式化容量

格式化容量 按照某种特定记录方式

#### 记录密度

​	道密度：给定一个半径，在半径内的磁道数

>磁盘各磁道上信息量是相同的，位密度不同

​	位密度：磁道单位长度能记录的位数

​	面密度：以上两个乘积

#### 平均存取时间

​	先找磁道（平均寻道时间）+磁头旋转定位扇区（平均查询扇区时间）+读取扇区时间+数据传输时间（可能没有）+磁盘控制器延时（可能没有）

​	平均寻道时间：磁头在磁盘径向方向上移动1/2个半径长度所用的时间

​	平均扇区查询时间：转一圈所用时间的一半

​	读取扇区时间：扇区数/转一圈所用的时间

​	数据传输时间：数据大小/总线速度

​	访问一个扇区的平均存取时间：其中的数据传输时间是**转一圈所需要的时间/扇区数**

#### 数据传输率

​	单位时间内向主机传送数据的字节数

​	$D_r=rN$

​	r是磁盘转数(转/秒)，N是每个磁道容量

### 磁盘地址

​	驱动器号+柱面号+盘面号+扇区号

### 硬盘的工作过程

​	取控制字

​	执行控制字

>读写是串行的，且读写不能同时进行



## 磁盘阵列(RAID廉价冗余磁盘阵列)

​	多个独立的物理磁盘组成一个逻辑盘

​	数据在上面分割交叉存储（条带化，实现并行存取）

​	提高吞吐量：

​		可以实现并行存取大幅提高存储系统的数据吞吐量

​	提高安可靠性：

​		镜像功能，两个磁盘同时读写，互为备份

​	提高容错能力：

​		数据校验

## 光盘存储器	

​	光盘片

​	光盘驱动器

​	光盘控制器

​	光盘驱动软件

​	密度高、携带方便、成本低、容量大、存储期限长、容易保存

​	CD-ROM:只读

​	CD-R:只可写一次

​	CD-RW：可以重复读写

​	DVD-ROM:高容量的CD-ROM

## 固态硬盘

​	高性能的Flash Memory

# 中断分类

内中断与外中断

硬件中断与软件中断

非屏蔽中断和可屏蔽中断